# Jolo API integration
Jolo is an API provider for money transfer in bank and mobile recharge. This JoloRecharge package allows easy integration of Jolo Recharge API and a very developer friendly API for rapid development of recharge system.
API provider website https://joloapi.com (for DMT), https://joloapi.com (for recharge)
For Jolo Money Transfer package see my JoloRecharge php package.

## Dependencies
* Phurl package (developed by https://github.com/imskm)
* Phurl package depends on cURL

## Supported
* For now, this Jolo rechrage API package only supports Prepaid / Postpaid mobile recharge and DTH recharge

## Create JoloRecharge object
```php
// Import Phurl class
use Components\Phurl\Phurl;
use Components\JoloRecharge\JoloRecharge;


// Instantiate JoloRecharge instance
// $phurl Phurl object  Handles http request
// $api_key string  API key of joloapi account
// $api_mode int  Mode 1 = Production, 0 = Development
$jolo_rech = new JoloRecharge(new Phurl, $api_key = "250xxxxxxxxx", $api_mode = 0);

```

## Create a Prepaid mobile recharge
```php
// Import Phurl class
use Components\Phurl\Phurl;
use Components\JoloRecharge\JoloRecharge;

$jolo_rech = new JoloRecharge(new Phurl, $api_key = "250xxxxxxxxx", $api_userid = "skmxxx", $api_mode = 0);

// Create prepaid mobile recharge
// All the parameters are required and key must match as given in this example
// $result is boolean, true if agent created succefully else false
// Note: Before making a recharge for the amount, you must check plan already
//       exists in operator for the same amount, recharge only with amount that
//       plan for same amount exist other wise recharge will fail and you might
//       not get refund for that. And this applies for other recharge API call
$result = $jolo_rech->create(new MobilePreRecharge([
	'phone' 	=> '9876543210',
	'amount'	=> 10,	      /* amount ranges from 4 - 25000 */
	'orderid' 	=> '123xxx',  /* generated by you */
	'operator' 	=> 'JO',      /* JO for Jio operator. See doc for operator code */
]));

// Check mobile recharge created
if ($result === true) {
	// mobile recharge created, so do what you want here (may be set message)
}

// Get response, came back from Jolo, save response for future reference
// If recharge disputed / recharged not maid but status is success then
//  order id can be used to check / report dispute in transaction, this
//  can be done for other recharge for dispute and status checking
// Response structure:
// stdClass Object
// (
//     [status] => SUCCESS
//     [error] => 0
//     [txid] => Z201904082754034885
//     [operator] => JO
//     [service] => 9992223335
//     [amount] => 10
//     [orderid] => 123
//     [operatorid] => 0
//     [balance] => 
//     [margin] => 
//     [time] => April 08 2019 04:15:30 PM
// )
$response = $jolo_rech->getResponse();

```

## Create Postpaid mobile recharge
```php
// Import Phurl class
use Components\Phurl\Phurl;
use Components\JoloRecharge\JoloRecharge;

$jolo_rech = new JoloRecharge(new Phurl, $api_key = "250xxxxxxxxx", $api_userid = "skmxxx", $api_mode = 0);

// Create postpaid mobile recharge
// All the parameters are required and key must match as given in this example
// $result is boolean, true if agent created succefully else false
$result = $jolo_rech->create(new MobilePostRecharge([
	'phone' 	=> '9876543210',
	'amount'	=> 100,	     /* amount ranges from 4 - 25000 */
	'orderid' 	=> '123xxx', /* generated by you */
	'operator' 	=> 'JO',     /* JO for Jio operator. See doc for operator code */
]));

// Check mobile recharge created
if ($result === true) {
	// mobile recharge created, so do what you want here (may be set message)
}

// Get response, came back from Jolo, save response for future reference
// If recharge disputed / recharged not maid but status is success then
//  order id can be used to check / report dispute in transaction, this
//  can be done for other recharge for dispute and status checking
// Response structure:
// stdClass Object
// (
//     [status] => SUCCESS
//     [error] => 0
//     [txid] => Z201904082754034885
//     [operator] => JO
//     [service] => 9992223335
//     [amount] => 10
//     [orderid] => 123
//     [operatorid] => 0
//     [balance] => 
//     [margin] => 
//     [time] => April 08 2019 04:15:30 PM
// )
$response = $jolo_rech->getResponse();

```

## Create DTH recharge
```php
// Import Phurl class
use Components\Phurl\Phurl;
use Components\JoloRecharge\JoloRecharge;

$jolo_rech = new JoloRecharge(new Phurl, $api_key = "250xxxxxxxxx", $api_userid = "skmxxx", $api_mode = 0);

// Create DTH recharge
// All the parameters are required and key must match as given in this example
// $result is boolean, true if agent created succefully else false
$result = $jolo_rech->create(new DthRecharge([
	'dthid' 	=> '3001915457',
	'amount'	=> 100,	     /* amount ranges from 4 - 25000 */
	'orderid' 	=> '123xxx', /* generated by you */
	'operator' 	=> 'AD',     /* AD = Airtel DTH */
]));

// Check dth recharge created
if ($result === true) {
	// dth recharge created, so do what you want here (may be set message)
}

// Get response, came back from Jolo, save response for future reference
// If recharge disputed / recharged not maid but status is success then
//  order id can be used to check / report dispute in transaction, this
//  can be done for other recharge for dispute and status checking
// Response structure:
// stdClass Object
// (
//     [status] => SUCCESS
//     [error] => 0
//     [txid] => Z201904082754034885
//     [operator] => AD
//     [service] => 3001915457
//     [amount] => 100
//     [orderid] => 123
//     [operatorid] => 0
//     [balance] => 
//     [margin] => 
//     [time] => April 08 2019 04:15:31 PM
// )
$response = $jolo_rech->getResponse();

```

## Check Jolo API balance (remaining)
```php
// Import Phurl class
use Components\Phurl\Phurl;
use Components\JoloRecharge\JoloRecharge;

$jolo_rech = new JoloRecharge(new Phurl, $api_key = "250xxxxxxxxx", $api_userid = "skmxxx", $api_mode = 0);

// Check API balance
// $result is boolean, true if agent created succefully else false
// Only one argument required, and no extra params is required for balance check
$result = $this->jolo_recharge->check('balance');

// If balance check request was successful
if ($result === true) {
	// then do something here (may be set flash message)
}

// Get response, came back from Jolo, save response for future reference
// Response structure:
// * If request not accepted:
// stdClass Object
// (
// 	[status] => FAILED
// 	[error] => 1
// )
// * If request accepted:
// stdClass Object
// (
//     [status] => SUCCESS
//     [error] => 0
//     [balance] => 0.00
//     [totalearn] => 0.00
//     [time] => April 10 2019 09:54:42 AM
// )
$response = $jolo_rech->getResponse();

```

## Check status of previous recharge transaction
```php
// Import Phurl class
use Components\Phurl\Phurl;
use Components\JoloRecharge\JoloRecharge;

$jolo_rech = new JoloRecharge(new Phurl, $api_key = "250xxxxxxxxx", $api_userid = "skmxxx", $api_mode = 0);

// Check status of recharge transaction (prepaid | postpaid | dth)
// All the parameters are required and key must match as given in this example
// $result is boolean, true if agent created succefully else false
// In this doc prepaid mobile recharge is documented but for postpaid mobile
// recharge and dth recharge use:
// postpaid --> for postpaid mobile recharge
// dth      --> for dth recharge
// as first argument to check method
$result = $this->jolo_recharge->check('prepaid', [
	'txn'		=> '123',   /* orderid that you generated not Jolo */
]);

// Check status of previous transaction was successful
// If it was successful then $result is true else false
if ($result === true) {
	// status of previous transaction was successful
}

// Get response, came back from Jolo, save response for future reference
// If recharge disputed / recharged not maid but status is success then
//  order id can be used to check / report dispute in transaction, this
//  can be done for other recharge for dispute and status checking
// Response structure:
// * If request not accepted:
// stdClass Object
// (
// 	[status] => FAILED
// 	[error] => 1
// )
// * If request accepted:
// stdClass Object
// (
// 	[status] => FAILED
// 	[error] => 360
// 	[txid] => Z2018000000000000
// 	[clientid] => 123
// 	[service] => 9999999999
// 	[amount] => 99
// 	[time] => January 01 2018 07:04:48 AM
// 	[margin] => 0
// 	[operatorid] => 0
// )
$response = $jolo_rech->getResponse();

```

## Report dispute for previous recharge transaction
```php
// Import Phurl class
use Components\Phurl\Phurl;
use Components\JoloRecharge\JoloRecharge;

$jolo_rech = new JoloRecharge(new Phurl, $api_key = "250xxxxxxxxx", $api_userid = "skmxxx", $api_mode = 0);

// Report dispute recharge transaction (prepaid | postpaid | dth)
// All the parameters are required and key must match as given in this example
// $result is boolean, true if agent created succefully else false
// In this doc prepaid mobile recharge is documented but for postpaid mobile
// recharge and dth recharge use:
// postpaid --> for postpaid mobile recharge
// dth      --> for dth recharge
// as first argument to dispute method
$result = $this->jolo_recharge->dispute('prepaid', [
	'txn'		=> '123',   /* orderid that you generated not Jolo */
]);

// Dispute reporting of previous transaction was successful
// If it was successful then $result is true else false
// ** If there was no dispute then $result is false
if ($result === true) {
	// Dispute report is reported for dispute transaction
}

// Get response, came back from Jolo, save response for future reference
// If recharge disputed / recharged not maid but status is success then
//  order id can be used to report dispute in transaction
// Response structure:
// * If request not accepted:
// stdClass Object
// (
// 	[status] => FAILED
// 	[error] => 123
// )
// * If request accepted:
// stdClass Object
// (
// 	[status] => REPORTED
// 	[error] => 0
// 	[txid] => Z2018000000000000
// 	[clientid] => 123
// 	[service] => 9999999999
// 	[amount] => 99
// )
$response = $jolo_rech->getResponse();

```

## Find operator and circle by mobile number or DTH subscriber ID
```php
// Import Phurl class
use Components\Phurl\Phurl;
use Components\JoloRecharge\JoloRecharge;

$jolo_rech = new JoloRecharge(new Phurl, $api_key = "250xxxxxxxxx", $api_userid = "skmxxx", $api_mode = 0);

// Find operator and circle detail of (mobile | dth)
// All the parameters are required and key must match as given in this example
// $result is boolean, true if agent created succefully else false
// first argument of detail() method can be:
// mobile 	--> for mobile operator and circle codes
// dth      --> for dth operator and circle codes
$result = $this->jolo_recharge->detail('mobile', [
	'mob'		=> '9876543210',   /* mobile number */
]);

// If detail api call for mobile | dth was succefful
// then $result will be true else false
if ($result === true) {
	// Detail of oeprator successfully fethced from Jolo
}

// Get response, came back from Jolo, save response for future reference
// If recharge disputed / recharged not maid but status is success then
//  order id can be used to report dispute in transaction
// Response structure:
// * If request not accepted:
// stdClass Object
// (
// 	[status] => FAILED
// 	[error] => 123
// )
// * If request accepted:
// stdClass Object
// (
//     [operator_code] => 28
//     [circle_code] => 15
//     [status] => SUCCESS
// )

$response = $jolo_rech->getResponse();

```

## Find plans and offer for mobile prepaid/postpaid
```php
// Import Phurl class
use Components\Phurl\Phurl;
use Components\JoloRecharge\JoloRecharge;

$jolo_rech = new JoloRecharge(new Phurl, $api_key = "250xxxxxxxxx", $api_userid = "skmxxx", $api_mode = 0);

// Find plans and offer of mobile prepaid and postpaid
// All the parameters are required and key must match as given in this example
// $result is boolean, true if agent created succefully else false
$result = $this->jolo_recharge->detail('mobile_plan', [
	'opt'		=> 28,  	/* operator code (airtel) */
	'cir'		=> 3,   	/* circle code (kolkata) */

	// typ => TUP,			/* Plan Category type (Top up, ..) */
	// max => ,				/* Number of rows */
	// amt => ,				/* Filter by amount */
]);

// If detail api call for mobile_plan was succefful
// then $result will be true else false
if ($result === true) {
	// Detail of plans successfully fethced from Jolo
}

// Get response, came back from Jolo
// Response structure:
// * If request not accepted:
// stdClass Object
// (
// 	[status] => FAILED
// 	[error] => 123
// )
// * If request accepted (plans can have large # of elements in array):
// stdClass Object
// (
//     [plans] => Array
//         (
//             [0] => stdClass Object
//                 (
//                     [Detail] => 30 MB 2G/3G/4G Data
//                     [Amount] => 5
//                     [Validity] => 1 Day
//                 )

//             [1] => stdClass Object
//                 (
//                     [Detail] => 100MB 2G/3G/4G Data
//                     [Amount] => 18
//                     [Validity] => 3 Days
//                 )
// 				...
//         )
//     [status] => SUCCESS
// )

$response = $jolo_rech->getResponse();

```

### Category codes
Plan/Offer category type for filtering plans in jolo api call. Code will be value of `typ`.

| Code     | Operator                                  |
| -------- | ----------------------------------------- |
| TUP      | Top-up Recharge                           |
| FTT      | Full Talk-time Recharge                   |
| 2G       | 2G Data Recharge                          |
| 3G       | 3G/4G Data Recharge                       |
| SMS      | SMS Pack Recharge                         |
| LSC      | Local/STD/ISD Call Recharge               |
| OTR      | Other Recharge                            |
| RMG      | National/International Roaming Recharge   |



## Find plans and offer for DTH
```php
// Import Phurl class
use Components\Phurl\Phurl;
use Components\JoloRecharge\JoloRecharge;

$jolo_rech = new JoloRecharge(new Phurl, $api_key = "250xxxxxxxxx", $api_userid = "skmxxx", $api_mode = 0);

// Find plans and offer of DTH
// All the parameters are required and key must match as given in this example
// $result is boolean, true if agent created succefully else false
$result = $this->jolo_recharge->detail('dth_plan', [
	'opt'		=> 97, 	/* operator code (airtel) */
]);

// If detail api call for dth_plan was succefful
// then $result will be true else false
if ($result === true) {
	// Detail of plans successfully fethced from Jolo
}

// Get response, came back from Jolo
// Response structure:
// * If request not accepted:
// stdClass Object
// (
// 	[status] => FAILED
// 	[error] => 123
// )
// * If request accepted (plans can have large # of elements in array):
// stdClass Object
// (
//     [plans] => Array
//         (
//             [0] => stdClass Object
//                 (
//                     [Detail] => DISH99 SD - 145+ Channels & Services
//                     [Amount] => 99
//                     [Validity] => 1 month
//                 )

//             [1] => stdClass Object
//                 (
//                     [Detail] => SUPER FAMILY SD - 277+ Channels & Services
//                     [Amount] => 270
//                     [Validity] => 1 month
//                 )
// 				...
//         )
//     [status] => SUCCESS
// )

$response = $jolo_rech->getResponse();

```
